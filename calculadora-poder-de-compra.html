<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NVH5B947');</script>
    <!-- End Google Tag Manager -->
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DCWV68YXJ9"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DCWV68YXJ9');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Poder de Compra - Prestamigo</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Calculadora gratuita de préstamos hipotecarios. Determine su pago mensual y capacidad de compra con nuestras herramientas profesionales.">
    <meta name="keywords" content="calculadora hipoteca, préstamo hipotecario, pago mensual, comprar casa, prestamigo">
    
    <!-- Favicon Configuration -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon/favicon.svg">
    <link rel="icon" type="image/png" href="/assets/favicon/favicon.png">
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="apple-touch-icon" href="/assets/favicon/favicon.png">
    
    <!-- Open Graph for social sharing -->
    <meta property="og:title" content="Calculadora de Poder de Compra - Prestamigo">
    <meta property="og:description" content="Calculadora gratuita de préstamos hipotecarios. Determine su pago mensual y capacidad de compra con nuestras herramientas profesionales.">
    <meta property="og:image" content="https://prestamigo.com/assets/favicon/favicon.png">
    <meta property="og:url" content="https://prestamigo.com/calculadora-poder-de-compra.html">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Calculadora de Poder de Compra - Prestamigo">
    <meta name="twitter:description" content="Calculadora gratuita de préstamos hipotecarios. Determine su pago mensual y capacidad de compra con nuestras herramientas profesionales.">
    <meta name="twitter:image" content="https://prestamigo.com/assets/favicon/favicon.png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Calculator Card */
        .calculator-card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
            background: white;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        /* Results */
        .results {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
            text-align: center;
        }
        
        .result-amount {
            font-size: 3rem;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 1.4rem;
            font-weight: 700;
        }
        
        .main-result {
            grid-column: 1 / -1;
            background: rgba(255,255,255,0.2);
            font-size: 1.1rem;
        }
        
        .main-result .result-value {
            font-size: 2rem;
        }
        
        /* Info Section */
        .info-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .info-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .info-section ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-section li {
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
            position: relative;
            padding-left: 30px;
        }
        
        .info-section li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }
        
        /* Footer */
        footer {
            background: #2c3e50;
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
        }
        
        .disclaimer {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .disclaimer p {
            margin-bottom: 15px;
        }
        
        .disclaimer p:last-child {
            margin-bottom: 0;
        }
        
        footer p {
            text-align: center;
            margin: 0;
            opacity: 0.8;
        }
        
        .detail-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #34495e;
            color: white;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            background: #2c3e50;
            transform: translateY(-2px);
        }
        
        /* Contact Button Styles */
        .contact-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .contact-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(52, 152, 219, 0.4);
            color: white;
        }
        
        .contact-button i {
            font-size: 1.2rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .calculator-card {
                padding: 25px;
            }
            
            .result-amount {
                font-size: 2.5rem;
            }
            
            .result-details {
                grid-template-columns: 1fr;
            }
            
            .contact-button {
                bottom: 20px;
                right: 20px;
                padding: 12px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NVH5B947"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Facebook Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '111216968559815');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=111216968559815&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Facebook Pixel Code -->

    <div class="container">
        <a href="/" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            Volver al Inicio
        </a>

        <div class="header">
            <h1><i class="fas fa-home"></i> Calculadora de Poder de Compra</h1>
            <p>Determine el monto del préstamo hipotecario estimado que puede calificar basado en sus ingresos, tasas de interés y otros factores importantes.</p>
        </div>
        
        <div class="calculator-card">
            <form id="loanCalculatorForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="annualIncome">
                            <i class="fas fa-dollar-sign"></i> Ingresos Anuales Brutos (USD)
                        </label>
                        <input 
                            type="number" 
                            id="annualIncome" 
                            placeholder="Ej: 100000" 
                            min="1" 
                            step="1"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="interestRate">
                            <i class="fas fa-percentage"></i> Tasa de Interés Anual (%)
                        </label>
                        <input 
                            type="number" 
                            id="interestRate" 
                            placeholder="Ej: 6.25" 
                            min="1" 
                            max="15"
                            step="0.01"
                            value="7.5"
                            required
                        >
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="loanTerm">
                            <i class="fas fa-calendar-alt"></i> Plazo del Préstamo
                        </label>
                        <select id="loanTerm" required>
                            <option value="30">30 años</option>
                            <option value="25">25 años</option>
                            <option value="20">20 años</option>
                            <option value="15">15 años</option>
                            <option value="10">10 años</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="downPaymentType">
                            <i class="fas fa-piggy-bank"></i> Pago de Entrada
                        </label>
                        <select id="downPaymentType" style="margin-bottom: 10px;">
                            <option value="percentage">Porcentaje (%)</option>
                            <option value="amount">Cantidad ($)</option>
                        </select>
                        <input 
                            type="number" 
                            id="downPaymentPercent" 
                            placeholder="Ej: 20" 
                            min="0" 
                            max="50"
                            step="0.1"
                            value="20"
                            required
                        >
                        <input 
                            type="number" 
                            id="downPaymentAmount" 
                            placeholder="Ej: 50000" 
                            min="0" 
                            step="100"
                            style="display: none;"
                        >
                    </div>
                </div>
                
                <div class="form-group">
                    <label style="margin-bottom: 15px; color: #2c3e50; font-size: 1.2rem;">
                        <i class="fas fa-credit-card"></i> Deudas Mensuales Existentes
                    </label>
                    
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="autoPayment" style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px;">Pago de Auto (USD)</label>
                            <input 
                                type="number" 
                                id="autoPayment" 
                                placeholder="0" 
                                min="0" 
                                step="1"
                                value="0"
                            >
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="creditCards" style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px;">Tarjetas de Crédito (USD)</label>
                            <input 
                                type="number" 
                                id="creditCards" 
                                placeholder="0" 
                                min="0" 
                                step="1"
                                value="0"
                            >
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="studentLoans" style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px;">Préstamos Estudiantiles (USD)</label>
                            <input 
                                type="number" 
                                id="studentLoans" 
                                placeholder="0" 
                                min="0" 
                                step="1"
                                value="0"
                            >
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label for="otherDebts" style="font-size: 0.9rem; color: #7f8c8d; margin-bottom: 5px;">Total Otros Pagos (USD)</label>
                            <input 
                                type="number" 
                                id="otherDebts" 
                                placeholder="0" 
                                min="0" 
                                step="1"
                                value="0"
                            >
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center;">
                        <span style="font-size: 1rem; color: #7f8c8d;">Total Deudas Mensuales: </span>
                        <span id="totalDebts" style="font-weight: 600; color: #2c3e50; font-size: 1.1rem;">$0</span>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="propertyTax">
                            <i class="fas fa-building"></i> Impuestos de Propiedad (Anual USD)
                        </label>
                        <input 
                            type="number" 
                            id="propertyTax" 
                            placeholder="Ej: 1500" 
                            min="0" 
                            step="100"
                            value="1500"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="homeInsurance">
                            <i class="fas fa-shield-alt"></i> Seguro de Vivienda (Anual USD)
                        </label>
                        <input 
                            type="number" 
                            id="homeInsurance" 
                            placeholder="Ej: 1200" 
                            min="0" 
                            step="100"
                            value="1200"
                        >
                    </div>
                </div>
                
                <button type="submit" class="calculate-btn">
                    <i class="fas fa-calculator"></i> Calcular Préstamo Hipotecario
                </button>
            </form>

            <div id="results" class="results">
                <h3><i class="fas fa-home"></i> Resultados de Su Préstamo</h3>
                <div class="results-grid">
                    <div class="result-item main-result">
                        <div class="result-label">Precio Máximo de Casa</div>
                        <div class="result-value" id="maxHomePrice">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Monto Máximo del Préstamo</div>
                        <div class="result-value" id="maxLoanAmount">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Pago Mensual (P&I)</div>
                        <div class="result-value" id="monthlyPayment">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Pago Total Mensual</div>
                        <div class="result-value" id="totalMonthlyPayment">$0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">DTI Ratio</div>
                        <div class="result-value" id="dtiRatio">0%</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Pago de Entrada Requerido</div>
                        <div class="result-value" id="downPaymentAmount">$0</div>
                    </div>
                    <div class="result-item" id="pmiSection" style="display: none;">
                        <div class="result-label">PMI Mensual</div>
                        <div class="result-value" id="pmiAmount">$0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="info-section">
            <h3><i class="fas fa-info-circle"></i> Información Importante</h3>
            <ul>
                <li><strong>Esta calculadora está basada en una relación deuda-ingreso del 50%</strong></li>
                <li><strong>Esta NO es una calculadora de asequibilidad financiera</strong></li>
                <li><strong>Esta estimación no refleja una precalificación u oferta de crédito</strong></li>
                <li>Su calificación puede variar según el programa de préstamo y prestamista</li>
                <li>Una precalificación real se basa en ingresos verificados y puntaje crediticio</li>
                <li>Los cálculos incluyen capital, interés, impuestos y seguro (PITI)</li>
                <li>PMI del 0.5% anual se aplica automáticamente si el pago de entrada es menor al 20%</li>
                <li>Las tasas de interés actuales pueden variar según su perfil crediticio</li>
                <li>Consulte con un prestamista para obtener una precalificación oficial</li>
                <li>Considere también gastos de cierre y mantenimiento de la vivienda</li>
                <li>Los impuestos y seguros varían según la ubicación de la propiedad</li>
            </ul>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="disclaimer">
                <p>INCITE LLC, DBA Prestamigo, es una empresa de educación. INCITE LLC, DBA Prestamigo no es un prestamista, no emite calificaciones de préstamos, y no extiende crédito de ningún tipo. Este sitio web es sólo para uso educativo. Todos los cálculos deben ser verificados de forma independiente. Este sitio web no es una oferta de préstamo y no debe utilizarse directamente para tomar decisiones sobre ofertas de viviendas, decisiones de compra ni selecciones de préstamos. No se garantiza que proporcione resultados exactos, que implique condiciones de préstamo, importes de calificación ni asesoramiento inmobiliario. Busque el consejo de un agente de bienes raíces con licencia, originador de préstamos, planificador financiero, contador y/o abogado de bienes raíces, legal y/o asesoramiento financiero.</p>
                
                <p><strong>Divulgación de Relación Comercial:</strong><br>
                INCITE LLC, DBA Prestamigo, tiene una relación comercial con Loan Factory, Inc. (NMLS 320841), una empresa de originación hipotecaria con licencia. Si usted solicita ser contactado o solicita más información, su información puede ser compartida con Loan Factory, Inc. o con otros profesionales hipotecarios con licencia para brindarle asistencia adicional. INCITE LLC, DBA Prestamigo, puede recibir compensación si usted elige trabajar con Loan Factory, Inc. u otros socios recomendados.</p>
                
                <p><strong>Transparencia:</strong><br>
                El contenido educativo proporcionado en este sitio puede no ser completamente imparcial debido a la relación comercial entre INCITE LLC, DBA Prestamigo, y Loan Factory, Inc.</p>
                
                <p>INCITE LLC, DBA Prestamigo, no está afiliada a la VA, la FHA ni a ninguna otra agencia gubernamental. Este sitio no ha sido aprobado por ninguna agencia gubernamental.</p>
                
                <p>NMLS 1940106<br>
                Loan Factory, Inc.<br>
                NMLS 320841</p>
                
                <p>Igualdad de Vivienda Prestamista</p>
                
                <p><strong>Sin citas en persona</strong></p>
            </div>
            <p>&copy; 2024 Prestamigo. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Go High Level Contact Button -->
    <button onclick="openBookingModal()" class="contact-button">
        <i class="fas fa-calendar-alt"></i>
        Agendar Consulta
    </button>

    <script>
        // Function to calculate and update total debts
        function updateTotalDebts() {
            const autoPayment = parseFloat(document.getElementById('autoPayment').value) || 0;
            const creditCards = parseFloat(document.getElementById('creditCards').value) || 0;
            const studentLoans = parseFloat(document.getElementById('studentLoans').value) || 0;
            const otherDebts = parseFloat(document.getElementById('otherDebts').value) || 0;
            
            const totalDebts = autoPayment + creditCards + studentLoans + otherDebts;
            document.getElementById('totalDebts').textContent = `$${totalDebts.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            
            return totalDebts;
        }
        
        // Add event listeners to debt input fields
        document.getElementById('autoPayment').addEventListener('input', updateTotalDebts);
        document.getElementById('creditCards').addEventListener('input', updateTotalDebts);
        document.getElementById('studentLoans').addEventListener('input', updateTotalDebts);
        document.getElementById('otherDebts').addEventListener('input', updateTotalDebts);
        
        // Handle down payment type toggle
        document.getElementById('downPaymentType').addEventListener('change', function() {
            const type = this.value;
            const percentInput = document.getElementById('downPaymentPercent');
            const amountInput = document.getElementById('downPaymentAmount');
            
            if (type === 'percentage') {
                percentInput.style.display = 'block';
                amountInput.style.display = 'none';
                percentInput.required = true;
                amountInput.required = false;
            } else {
                percentInput.style.display = 'none';
                amountInput.style.display = 'block';
                percentInput.required = false;
                amountInput.required = true;
            }
        });
        
        document.getElementById('loanCalculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get input values
            const annualIncome = parseFloat(document.getElementById('annualIncome').value);
            const interestRate = parseFloat(document.getElementById('interestRate').value);
            const loanTerm = parseInt(document.getElementById('loanTerm').value);
            const downPaymentType = document.getElementById('downPaymentType').value;
            const propertyTax = parseFloat(document.getElementById('propertyTax').value) || 0;
            const homeInsurance = parseFloat(document.getElementById('homeInsurance').value) || 0;
            const totalMonthlyDebts = updateTotalDebts();
            
            let downPaymentPercent, downPaymentDollarAmount;
            
            if (downPaymentType === 'percentage') {
                downPaymentPercent = parseFloat(document.getElementById('downPaymentPercent').value);
                if (!downPaymentPercent || downPaymentPercent < 0) {
                    alert('Por favor ingrese un porcentaje de enganche válido');
                    return;
                }
            } else {
                downPaymentDollarAmount = parseFloat(document.getElementById('downPaymentAmount').value);
                if (!downPaymentDollarAmount || downPaymentDollarAmount < 0) {
                    alert('Por favor ingrese una cantidad de enganche válida');
                    return;
                }
            }
            
            if (!annualIncome || annualIncome <= 0) {
                alert('Por favor ingrese un ingreso anual válido');
                return;
            }
            
            if (!interestRate || interestRate <= 0) {
                alert('Por favor ingrese una tasa de interés válida');
                return;
            }
            
            // Calculate monthly income and maximum housing payment (50% DTI rule)
            const monthlyIncome = annualIncome / 12;
            const maxTotalMonthlyPayment = (monthlyIncome * 0.50) - totalMonthlyDebts;
            
            if (maxTotalMonthlyPayment <= 0) {
                alert('Sus deudas actuales son demasiado altas para calificar para un préstamo hipotecario');
                return;
            }
            
            // Calculate monthly property tax and insurance
            const monthlyPropertyTax = propertyTax / 12;
            const monthlyInsurance = homeInsurance / 12;
            const monthlyRate = interestRate / 100 / 12;
            const numPayments = loanTerm * 12;
            
            let maxLoanAmount, maxHomePrice, downPaymentAmount, actualPMI = 0;
            
            if (downPaymentType === 'percentage') {
                // Original percentage-based calculation
                let estimatedPMI = 0;
                if (downPaymentPercent < 20) {
                    const estimatedLoanAmount = (maxTotalMonthlyPayment - monthlyPropertyTax - monthlyInsurance) * ((Math.pow(1 + monthlyRate, numPayments) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, numPayments)));
                    estimatedPMI = (estimatedLoanAmount * 0.005) / 12;
                }
                
                const maxPrincipalAndInterest = maxTotalMonthlyPayment - monthlyPropertyTax - monthlyInsurance - estimatedPMI;
                
                if (maxPrincipalAndInterest <= 0) {
                    alert('Los impuestos y seguros son demasiado altos para permitir un pago de préstamo');
                    return;
                }
                
                maxLoanAmount = maxPrincipalAndInterest * ((Math.pow(1 + monthlyRate, numPayments) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, numPayments)));
                
                if (downPaymentPercent < 20) {
                    actualPMI = (maxLoanAmount * 0.005) / 12;
                }
                
                maxHomePrice = maxLoanAmount / (1 - (downPaymentPercent / 100));
                downPaymentAmount = maxHomePrice * (downPaymentPercent / 100);
                
            } else {
                // Dollar amount-based calculation - iterate to find optimal home price
                downPaymentAmount = downPaymentDollarAmount;
                let homePrice = downPaymentDollarAmount * 4; // Starting estimate
                let step = 50000;
                let bestHomePrice = 0;
                
                for (let iterations = 0; iterations < 100; iterations++) {
                    const loanAmount = homePrice - downPaymentDollarAmount;
                    const currentDownPaymentPercent = (downPaymentDollarAmount / homePrice) * 100;
                    
                    if (loanAmount <= 0) {
                        homePrice += step;
                        continue;
                    }
                    
                    // Calculate monthly PI
                    const monthlyPI = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                    
                    // Calculate PMI if down payment is less than 20%
                    let monthlyPMI = 0;
                    if (currentDownPaymentPercent < 20) {
                        monthlyPMI = (loanAmount * 0.005) / 12;
                    }
                    
                    // Calculate taxes and insurance based on home price
                    const monthlyTax = (homePrice * (propertyTax / homePrice)) / 12;
                    const monthlyIns = (homePrice * (homeInsurance / homePrice)) / 12;
                    
                    const totalMonthlyPayment = monthlyPI + monthlyTax + monthlyIns + monthlyPMI;
                    
                    if (Math.abs(totalMonthlyPayment - maxTotalMonthlyPayment) < 50) {
                        bestHomePrice = homePrice;
                        maxLoanAmount = loanAmount;
                        actualPMI = monthlyPMI;
                        break;
                    } else if (totalMonthlyPayment < maxTotalMonthlyPayment) {
                        homePrice += step;
                    } else {
                        homePrice -= step;
                        step = Math.max(step / 2, 1000);
                    }
                    
                    if (step < 1000) {
                        bestHomePrice = homePrice;
                        maxLoanAmount = homePrice - downPaymentDollarAmount;
                        if ((downPaymentDollarAmount / homePrice * 100) < 20) {
                            actualPMI = (maxLoanAmount * 0.005) / 12;
                        }
                        break;
                    }
                }
                
                maxHomePrice = bestHomePrice;
                downPaymentPercent = (downPaymentDollarAmount / maxHomePrice) * 100;
            }
            
            // Calculate actual monthly payments
            const actualMonthlyPI = maxLoanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
            const actualTotalMonthly = actualMonthlyPI + monthlyPropertyTax + monthlyInsurance + actualPMI;
            
            // Calculate DTI ratio
            const finalDtiRatio = ((totalMonthlyDebts + actualTotalMonthly) / monthlyIncome) * 100;
            
            // Update results
            document.getElementById('maxLoanAmount').textContent = `$${maxLoanAmount.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('maxHomePrice').textContent = `$${maxHomePrice.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('monthlyPayment').textContent = `$${actualMonthlyPI.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('totalMonthlyPayment').textContent = `$${actualTotalMonthly.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            document.getElementById('dtiRatio').textContent = `${finalDtiRatio.toFixed(1)}%`;
            document.getElementById('downPaymentAmount').textContent = `$${downPaymentAmount.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            
            // Show/hide PMI section based on down payment
            if (downPaymentPercent < 20) {
                document.getElementById('pmiSection').style.display = 'block';
                document.getElementById('pmiAmount').textContent = `$${actualPMI.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
            } else {
                document.getElementById('pmiSection').style.display = 'none';
            }
            
            // Show results
            document.getElementById('results').style.display = 'block';
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            // Track event
            if (typeof fbq !== 'undefined') {
                fbq('track', 'ViewContent', {
                    content_name: 'Loan Calculator',
                    content_category: 'Calculator',
                    value: maxLoanAmount,
                    currency: 'USD'
                });
            }
        });
        
        // Initialize total debts display
        updateTotalDebts();
    </script>
    
    <!-- Floating Contact Button -->
    <div style="position: fixed; bottom: 30px; right: 30px; z-index: 9999; animation: pulse 2s infinite;">
        <button onclick="openBookingModal()" 
           style="display: inline-block; background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 15px 25px; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 16px; box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4); transition: all 0.3s ease; border: 2px solid transparent; cursor: pointer;"
           onmouseover="this.style.transform='translateY(-3px) scale(1.05)'; this.style.boxShadow='0 10px 30px rgba(52, 152, 219, 0.6)'; this.style.background='linear-gradient(135deg, #2980b9, #3498db)'; this.style.border='2px solid #fff';"
           onmouseout="this.style.transform=''; this.style.boxShadow='0 6px 20px rgba(52, 152, 219, 0.4)'; this.style.background='linear-gradient(135deg, #3498db, #2980b9)'; this.style.border='2px solid transparent';">
            📅 Agendar Consulta
        </button>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 10000; overflow-y: auto;">
        <div style="position: relative; margin: 2% auto; padding: 0; width: 95%; max-width: 700px; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.3); min-height: 600px;">
            <button onclick="closeBookingModal()" style="position: absolute; top: 15px; right: 20px; background: #ff4757; color: white; border: none; font-size: 18px; cursor: pointer; border-radius: 50%; width: 35px; height: 35px; z-index: 10001; display: flex; align-items: center; justify-content: center;">&times;</button>
            <div id="bookingContent" style="padding: 50px 20px 20px 20px; height: 650px;">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        function openBookingModal() {
            event.preventDefault();
            event.stopPropagation();
            
            const modal = document.getElementById('bookingModal');
            const content = document.getElementById('bookingContent');
            
            // Show modal
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // Load Go High Level widget content
            content.innerHTML = `
                <iframe src="https://api.leadconnectorhq.com/widget/booking/qBoIcTx0Mr1zIeWeWD9D" 
                        style="width: 100%; height: 100%; border: none; border-radius: 10px;" 
                        frameborder="0" 
                        scrolling="auto"
                        allowfullscreen>
                </iframe>
            `;
            
            return false;
        }
        
        function closeBookingModal() {
            const modal = document.getElementById('bookingModal');
            const content = document.getElementById('bookingContent');
            
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Clear content to stop any ongoing processes
            content.innerHTML = '<div style="text-align: center; padding: 50px;">Cargando...</div>';
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('bookingModal');
            const modalContent = modal.querySelector('div');
            
            if (event.target === modal) {
                closeBookingModal();
            }
        });
        
        // Prevent event bubbling inside modal
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('bookingModal');
            if (modal) {
                modal.querySelector('div').addEventListener('click', function(event) {
                    event.stopPropagation();
                });
            }
        });
    </script>
    <script src="https://link.msgsndr.com/js/form_embed.js" type="text/javascript"></script>
    <script src="js/tracking.js"></script>

    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 768px) {
            div[style*="position: fixed"] {
                bottom: 20px !important;
                right: 20px !important;
            }
            
            div[style*="position: fixed"] a {
                padding: 12px 20px !important;
                font-size: 14px !important;
            }
        }
    </style>
</body>
</html>